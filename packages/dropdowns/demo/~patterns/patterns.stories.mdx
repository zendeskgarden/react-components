import { useCallback } from 'react';
import { Meta, Canvas, Story } from '@storybook/addon-docs';
import { useArgs } from '@storybook/client-api';
import { Combobox } from '@zendeskgarden/react-dropdowns';
import { MenuButtonStory } from './stories/MenuButtonStory';
import { MenuNestedStory } from './stories/MenuNestedStory';
import { PortalStory } from './stories/PortalStory';
import { BASE_ITEMS, NESTED_ITEMS } from './stories/data';

<Meta title="Packages/Dropdowns/[patterns]" />

# Patterns

## Render menu with custom button

The `button` property can alternatively be set as a callback function that returns
custom button JSX. By default, `Menu` will use a Garden `Button` internally.

This is an option for things like icon buttons.

<Canvas>
  <Story name="Menu button">{args => <MenuButtonStory {...args} />}</Story>
</Canvas>

## Menu with nested items

Adding an `Item` with `type="next"` will enable nested menu
behavior. It can be implemented with or without controlled focus.

The subsequent nested menu will then need an `Item` with `type="previous"`
to allow backwards navigation to the previous menu.

<Canvas>
  <Story name="Menu nested" args={{ items: BASE_ITEMS }}>
    {args => {
      const [_, updateArgs, resetArgs] = useArgs();
      const onChange = useCallback(({ type, isExpanded }) => {
        const isNext = type.includes('next');
        const isPrev = type.includes('previous');
        if (isNext || isPrev) {
          updateArgs({ items: isNext ? NESTED_ITEMS : BASE_ITEMS });
        } else if (isExpanded === false) {
          resetArgs(['items']);
        }
      }, []);
      return <MenuNestedStory {...args} onChange={onChange} />;
    }}
  </Story>
</Canvas>

## Portal

Dropdowns can be rendered in a different DOM location than inline with their
associated trigger component. This is done via React portals under the hood.
You typically will need to portal if you are using dropdown components inside an
element with `overflow: hidden` / `auto` / `scroll` CSS styles. See in these
examples that the dropdowns are currently getting cropped.

### Listbox

Enable the `listboxAppendToNode` property to see the full listbox.

### Menu

Enable the `appendToNode` property to see the full menu.

<Canvas>
  <Story
    name="Portal"
    args={{ listboxAppendToNode: false, menuAppendToNode: false }}
    argTypes={{
      listboxAppendToNode: { control: 'boolean', name: 'Combobox listboxAppendToNode' },
      menuAppendToNode: { control: 'boolean', name: 'Menu appendToNode' }
    }}
  >
    {args => <PortalStory {...args} />}
  </Story>
</Canvas>
